# sobani-tracker

## Introduction

Aim to set up a tracker server for sobani service and clients

## Setup

Clone to your instance

```
git clone https://github.com/nekomeowww/sobani-tracker.git
```

Install dependencies

```
cd sobani-tracker
yarn install
```

Start server

```
yarn run
```

## API Documentation

### Methods

#### announce

Announce action relates tp the first connection from peer to server, within this action, a client send three parameters to tracker server in order to record and make the share action possible.

If sending is successful, an [announceReceived](#announceReceived)  object will be returned.

**POST** /

| Parameter | Type                          | Required | Description                                                  |
| --------- | ----------------------------- | -------- | ------------------------------------------------------------ |
| action    | string                        | yes      | Action of the current stage of making POST method to server, for the first connection to server, use `announce` as action |
| data      | [announceBody](#announceBody) | yes      | Data body for announce                                       |

Expected response from server:

```
{
	"action": "announceReceived",
	"data": {
		"shareId": "1AbhoECj"
	}
}
```

#### pulse

Pulse action meant to make maintaining the connection and the sharing session valid and possible by rapidly sending a packet to server to report the `Alive` state of the client. By doing this, server will store the session and shareId while the clients are alive, if a client stopped to send a packet, server will delete the related shareId and multiaddr it announced before. (**Default expiration time will be 5 minutes**)

If sending is successful, a [pulseReceived](#pulseReceived) object is returned.

**POST** /

| Parameter | Type                    | Required | Description                                                  |
| --------- | ----------------------- | -------- | ------------------------------------------------------------ |
| action    | string                  | yes      | Action of the current stage of making POST method to server, to have heartbeat packet to server, use `pulse` as action |
| data      | [pulseBody](#pulseBody) | optional | Data body for heartbeat packet to server, to update values on server, include `override: true` in [pulseBody](#pulseBody) |

Expected response from server:

```
{
	"action": "pulseReceived"
}
```

#### push

Push action tells the server the unique shareId of the target client the peers shared. Tracker server respond with the multiaddr back to the requesting client, so on, the client can try to establish the connection between. 

If sending is successful, a [pushReceived](#pushReceived) is returned.

**POST** /

| Parameter | Type                  | Required | Description                                                  |
| --------- | --------------------- | -------- | ------------------------------------------------------------ |
| action    | string                | yes      | Action of the current stage of making POST method to server, for requesting sharing data, use `push` action to get `multiaddr` value |
| data      | [pushBody](#pushBody) | yes      | Object of push data body                                     |

Expected response from server:

```
{
	"action": "pushReceived",
	"data": {
		"multiaddr": "ip4/0.0.0.0/tcp/8080/p2p/0sCFajniCW92aP1fHm49RAhyrKC6uXVj"
	}
}
```

### Types

#### share

| Field   | Type   | Required | Description                 |
| ------- | ------ | -------- | --------------------------- |
| shareId | string | yes      | ShareId generated by server |

#### multiaddr

| Field     | Type   | Required | Description                    |
| --------- | ------ | -------- | ------------------------------ |
| multiaddr | string | yes      | Multiaddr registered in server |

#### annouceBody

| Field     | Type    | Required | Description                                         |
| --------- | ------- | -------- | --------------------------------------------------- |
| ip        | string  | yes      | IPv4 address of the announcing instance or computer |
| port      | integer | yes      | Port opened from client                             |
| multiaddr | string  | yes      | Multiaddress generated by client                    |

#### pulseBody

| Field     | Type    | Required | Description                                                  |
| --------- | ------- | -------- | ------------------------------------------------------------ |
| override  | boolean | optional | If set to `true`, the following data in this body object will be  updated to server, default is `false` |
| ip        | string  | optional | Based on override param, server will update the ip address according to the given one |
| port      | string  | optional | Based on override param, server will update the port mapping according to the given one |
| multiaddr | string  | optional | Based on override param, server will update the port mapping according to the given one |
| shareId   | boolean | optional | If set to `true`, server will regenerate a shareId to client |

#### pushBody

| Field     | Type   | Required | Description                                                  |
| --------- | ------ | -------- | ------------------------------------------------------------ |
| shareId   | string | yes      | The unique shareId from other client, this shareId can  be get through [announce](#announce) method or [pulse](#pulse) method with override set to `true` |
| multiaddr | string | yes      | The multiaddr generated by client, this multiaddr should be the source instance one, not the target instance multiaddr. |

#### announceReceived

| Field  | Type            | Required | Description                                                  |
| ------ | --------------- | -------- | ------------------------------------------------------------ |
| action | string          | yes      | The action has been done by server, default is `announceReceived` |
| data   | [share](#share) | yes      | Object that contains shareId                                 |

#### pulseReceived

| Field  | Type    | Required | Description                                                  |
| ------ | ------- | -------- | ------------------------------------------------------------ |
| action | string  | yes      | The action has been done by server, default is `pulseReceived` |
| data   | boolean | yes      | `true` if overriden data was successfully set                |

#### pushReceived

| Field  | Type                    | Required | Description                                                  |
| ------ | ----------------------- | -------- | ------------------------------------------------------------ |
| action | string                  | yes      | The action has been done by server, default is `pushReceived` |
| data   | [multiaddr](#multiaddr) | yes      | Object that contains multiaddr                               |

